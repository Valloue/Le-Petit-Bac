import{initializeApp as w}from"https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";import{getAuth as v,onAuthStateChanged as I,signOut as E}from"https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";import{getFirestore as C,doc as d,getDoc as m,query as p,collection as f,where as c,onSnapshot as g,updateDoc as D}from"https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver(e=>{for(const r of e)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function o(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerPolicy&&(r.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?r.credentials="include":e.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(e){if(e.ep)return;e.ep=!0;const r=o(e);fetch(e.href,r)}})();const G={apiKey:"AIzaSyDVtm-IgdfMZ0oToXw0dLewpH1q6BZUTN0",authDomain:"onion-note.firebaseapp.com",projectId:"onion-note",storageBucket:"onion-note.firebasestorage.app",messagingSenderId:"678827914649",appId:"1:678827914649:web:66882c871778d550d90f08",measurementId:"G-71M8EMYFB8"},y=w(G),u=v(y),i=C(y);I(u,t=>{t?(sessionStorage.setItem("userId",t.uid),L(t.uid),M(t.uid)):window.location.href="/"});async function L(t){const a=await d(i,"users",t),n=(await m(a)).data();document.getElementById("userPseudo").textContent=n.pseudo}function M(t){const a=p(f(i,"games"),c("status","==","active"),c("participants","array-contains",t));g(a,n=>{const e=document.getElementById("activeGames");e.innerHTML="",n.forEach(r=>{const s=r.data(),l=h(s,r.id);e.appendChild(l)})});const o=p(f(i,"games"),c("status","==","completed"),c("participants","array-contains",t));g(o,n=>{const e=document.getElementById("completedGames");e.innerHTML="",n.forEach(r=>{const s=r.data(),l=h(s,r.id);e.appendChild(l)})})}function h(t,a){const o=document.createElement("div");return o.className="game-card",o.innerHTML=`
        <h3>${t.title}</h3>
        <p>
            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/>
            </svg>
            ${t.participants.length} joueurs
        </p>
        <p>
            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
            </svg>
            ${t.categories.join(", ")}
        </p>
    `,o.addEventListener("click",async n=>{n.preventDefault();try{(await m(d(i,"games",a))).exists()?(sessionStorage.setItem("currentGameId",a),window.location.href="/game"):alert("Cette partie n'existe pas ou a été supprimée")}catch(e){console.error("Erreur lors de l'accès à la partie:",e),alert("Erreur lors de l'accès à la partie")}}),o}document.getElementById("logoutBtn").addEventListener("click",async()=>{try{await E(u),window.location.href="/"}catch(t){alert("Erreur lors de la déconnexion : "+t.message)}});document.getElementById("joinGameBtn").addEventListener("click",async()=>{const t=prompt("Entrez l'ID de la partie que vous souhaitez rejoindre :");if(t)try{const a=await m(d(i,"games",t));if(!a.exists()){alert("Cette partie n'existe pas");return}const o=a.data();if(o.status!=="active"){alert("Cette partie est déjà terminée");return}if(o.participants.includes(u.currentUser.uid)){sessionStorage.setItem("currentGameId",t),window.location.href="/game";return}await D(d(i,"games",t),{participants:[...o.participants,u.currentUser.uid]}),sessionStorage.setItem("currentGameId",t),window.location.href="/game"}catch(a){console.error("Erreur lors de la jointure de la partie:",a),alert("Erreur lors de la jointure de la partie")}});
